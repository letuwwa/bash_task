function diskInput {
  read -p "Input name of disk: " value
  if lsblk -f | grep -wq $value; then
      (echo n; echo p; echo 1; echo ; echo ; echo t; echo fd; echo w) | fdisk /dev/$value
      echo $value
   else
      echo Disk doesnt exist
  fi
}

function main {
 configFile=/etc/sysconfig/network-scripts/ifcfg-enp0s3
 if grep -q ONBOOT=yes $configFile
  then echo "ONBOOT=yes, config is corect"
 else
  grep "ONBOOT=no" -P -R -I -l $configFile | xargs sed -i 's/ONBOOT=no/ONBOOT=yes/g'
  echo "ONBOOT setted on YES, config is changed"
 fi

 sshdConfig=/etc/ssh/sshd_config
 if grep -q 'PermitRootLogin no' $sshdConfig
  then echo 'PermitRootLogin no, config is correct'
 else
  echo "PermitRootLogin setted on NO, config is changed"
  grep '#PermitRootLogin yes' -P -R -I -l $sshdConfig | xargs sed -i 's/#PermitRootLogin yes/PermitRootLogin no/g'
 fi

 iptables -A INPUT -p tcp --dport 22 -j ACCEPT
 yum update -y --disablerepo=*

 repoFile=/etc/yum.repos.d/mnt_iso_.repo
 if [ -f "$repoFile" ];
 then
    echo "File $repoFile exist, repo is enabled"
 else
    mkdir -p /mnt/iso
    mount -o loop CentOS-7-x86_64-DVD-2009.iso /mnt/iso
    yum-config-manager --add-repo=file:///mnt/iso
    echo "File $repoFile does not exist, repo created and enabled"
 fi
 
 echo "Input repo name to mount:"
 read REPO
 if mdadm --detail --scan --verbose | grep -q /dev/$REPO
 then
     echo $REPO alredy exist!
 else
     disk1=$(diskInput)
     disk2=$(diskInput)
     disk3=$(diskInput)
     mdadm --create /dev/$REPO --level=5 --raid-devices=3 /dev/$disk1 /dev/$disk2 /dev/$disk3
     pvcreate /dev/$REPO
     mkfs.ext4 /dev/$REPO
     mount /dev/$REPO /mnt
 fi
 
 systemctl enable rpcbind
 systemctl enable nfs-server
 systemctl enable nfs-lock
 systemctl enable nfs-idmap
 systemctl start rpcbind
 systemctl start nfs-server
 systemctl start nfs-lock
 systemctl start nfs-idmap
 r -p /home/nfs
 chmod -R 777 /home/nfs
 echo "192.168.56.1(rw,sync,no_root_squash,no_all_squash)" >> /etc/exports 
 systemctl restart nfs-server
 firewall-cmd –permanent –add-port=111/tcp
 firewall-cmd –permanent –add-port=54302/tcp
 firewall-cmd –permanent –add-port=20048/tcp
 firewall-cmd –permanent –add-port=2049/tcp
 firewall-cmd –permanent –add-port=46666/tcp
 firewall-cmd –permanent –add-port=42955/tcp
 firewall-cmd –permanent –add-port=875/tcp
 firewall-cmd –permanent –zone=public –add-service=nfs
 firewall-cmd –permanent –zone=public –add-service=mountd
 firewall-cmd –permanent –zone=public –add-service=rpc-bind
 firewall-cmd –reload
}

main 2>&1 | tee -a file.log
