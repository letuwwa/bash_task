function diskInput {
  read -p "Input name of disk: " value
  if lsblk -f | grep -wq $value; then
      (echo n; echo p; echo 1; echo ; echo ; echo t; echo fd; echo w) | fdisk /dev/$value
      echo $value
   else
      echo Disk doesnt exist
  fi
}

function main {

 configFile=/etc/sysconfig/network-scripts/ifcfg-enp0s3

 if grep -q ONBOOT=yes $configFile
  then echo "ONBOOT=yes, config is corect"
 else
  grep "ONBOOT=no" -P -R -I -l $configFile | xargs sed -i 's/ONBOOT=no/ONBOOT=yes/g'
  echo "ONBOOT setted on YES, config is changed"
 fi


 sshdConfig=/etc/ssh/sshd_config

 if grep -q 'PermitRootLogin no' $sshdConfig
  then echo 'PermitRootLogin no, config is correct'
 else
  echo "PermitRootLogin setted on NO, config is changed"
  grep '#PermitRootLogin yes' -P -R -I -l $sshdConfig | xargs sed -i 's/#PermitRootLogin yes/PermitRootLogin no/g'
 fi


 iptables -A INPUT -p tcp --dport 22 -j ACCEPT
 yum update -y --disablerepo=*


 repoFile=/etc/yum.repos.d/mnt_iso_.repo

 if [ -f "$repoFile" ];
 then
    echo "File $repoFile exist, repo is enabled"
 else
    mkdir -p /mnt/iso
    mount -o loop CentOS-7-x86_64-DVD-2009.iso /mnt/iso
    yum-config-manager --add-repo=file:///mnt/iso
    echo "File $repoFile does not exist, repo created and enabled"
 fi
 
 disk1=$(diskInput)
 disk2=$(diskInput)
 disk3=$(diskInput)
 echo "Input repo name to mount:"
 read REPO
 mdadm --create /dev/md5 --level=5 --raid-devices=3 /dev/$disk1 /dev/$disk2 /dev/$disk3
 pvcreate /dev/$REPO
 mkfs.ext4 /dev/$REPO
 mount /dev/$REPO /mnt
}

main 2>&1 | tee -a file.log
